<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> UITextView实现占位文字的两种方法 · RecherJ's blog</title><meta name="description" content="UITextView实现占位文字的两种方法 - RecherJ"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://recherj.github.io/atom.xml" title="RecherJ's blog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://weibo.com/u/2698628733" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/RecherJ" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">UITextView实现占位文字的两种方法</h1><div class="post-info">Apr 9, 2016</div><div class="post-content"><p>在Cocoa Touch框架中有两种系统自带的文本输入控件：<code>UITextFiled</code>和<code>UITextView</code></p>
<a id="more"></a>
<ul>
<li>UITextFiled特点<ul>
<li>只显示一行文本输入</li>
<li>高度（30）默认不能修改</li>
<li>没有拖拽滚动(父控件是UIscrollView除外)</li>
</ul>
</li>
<li>UITextView特点<ul>
<li>支持多行输入显示</li>
<li>支持滚动（继承自UIscrollView）</li>
<li>没有占位文字（placeholder）</li>
<li>本质就是一个可调整的多行输入文本框<br>有时候我们希望给一个多行文本框增加一个占位文字的功能，来提示用户输入的内容。但是这两种都不能满足我们的要求，这样我们可以自定义一个这样的控件，实现我们的需要。</li>
</ul>
</li>
</ul>
<p>实现思路：<br><strong>自定义一个类，继承自UITextView，在现有功能的基础上增加一个占位文字的功能</strong></p>
<p>两种实现方法：</p>
<ol>
<li><p>实现UITextView内部的- (void)drawRect:(CGRect)rect方法，将占位文字文字画到UITextView控件上<br> 1.1 在.h的头文件中给外界提供一个占位文字的属性</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  占位文字</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSString</span> *placeholder;</span><br></pre></td></tr></table></figure>
<p> 1.2 将占位文字画到矩形框中</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  绘制占位文字</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)drawRect:(<span class="built_in">CGRect</span>)rect &#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">NSMutableDictionary</span> *attrs = [<span class="built_in">NSMutableDictionary</span> dictionary];</span><br><span class="line">    attrs[<span class="built_in">NSFontAttributeName</span>] = <span class="keyword">self</span>.font;</span><br><span class="line">    attrs[<span class="built_in">NSForegroundColorAttributeName</span>] = [<span class="built_in">UIColor</span> lightGrayColor];</span><br><span class="line">    <span class="comment">// 在textView的矩形框中绘制文字</span></span><br><span class="line">    [<span class="keyword">self</span>.placeholder drawInRect:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">64</span>, <span class="keyword">self</span>.frame.size.width, <span class="keyword">self</span>.frame.size.height) withAttributes:attrs];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>注：label的font要在初始化时确定，不然程序会奔溃<br>    1.3 采用通知的方式监听键盘文字的改变。文字一旦改变，会发出一个<code>UITextViewTextDidChangeNotification</code>的通知，所以给TextView初始化后就添加一个监听器<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">instancetype</span>)initWithFrame:(<span class="built_in">CGRect</span>)frame</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> initWithFrame:frame]) &#123;</span><br><span class="line">        <span class="comment">// 添加监听器，监听自己的文字改变通知</span></span><br><span class="line">        [[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(textDidChange) name:<span class="built_in">UITextViewTextDidChangeNotification</span> object:<span class="literal">nil</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 时刻监听文字键盘文字的变化，文字一旦改变便调用setNeedsDisplay方法</span></span><br><span class="line">- (<span class="keyword">void</span>)textDidChange</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 该方法会调用drawRect:方法，立即重新绘制占位文字</span></span><br><span class="line">    [<span class="keyword">self</span> setNeedsDisplay];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>1.4 添加监听器就要重写dealloc方法，当控件被销毁时，移除监听器<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)dealloc</span><br><span class="line">&#123;</span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] removeObserver:<span class="keyword">self</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>1.5 用户一旦输入了文字，就需要将绘制的占位文字删除掉，所以在<code>drawRect:</code>方法一进来就增加判断</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 如果一旦有输入文字，直接返回，不再绘制占位文字</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">self</span>.hasText) <span class="keyword">return</span>;</span><br></pre></td></tr></table></figure>
<p>因为<code>drawRect:</code>方法是每次调用会将上次绘制的内容删除掉，重新绘制，所以增加一个这样的判断，当有文字时，再重绘时直接返回，不进行后面的绘制，这样就可以办到有文字输入后，删除占位文字</p>
<p>但其实还有一些问题，控制器中拿到这个textView控件后，可能会随时修改占位文字的字体大小、占位文字的内容，所以避免这些问题，随时响应修改，就需要重写这些属性的setter方法<br>    1.6 重写字体、占位文字等属性的setter方法</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 占位文字的setter方法</span></span><br><span class="line">- (<span class="keyword">void</span>)setPlaceholder:(<span class="built_in">NSString</span> *)placeholder</span><br><span class="line">&#123;</span><br><span class="line">    _placeholder = placeholder;</span><br><span class="line">    <span class="comment">// 文字一旦改变，立马重写绘制（内部会调drawRect:方法）</span></span><br><span class="line">    [<span class="keyword">self</span> setNeedsDisplay]; </span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 字体属性setter方法</span></span><br><span class="line">- (<span class="keyword">void</span>)setFont:(<span class="built_in">UIFont</span> *)font</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">super</span> setFont:font];</span><br><span class="line">    [<span class="keyword">self</span> setNeedsDisplay];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样，这个在系统自带控件基础上自定义的<code>UITextView</code>控件就有占位文字功能了。</p>
<p><img src="/img/1557972-334aa4e9780dfa54.png" alt="成果图"></p>
<ol>
<li><p>给自定TextView控件增加一个label属性，用来显示占位文字<br>这里，相同的部分就不在贴代码，只阐述实现步骤和思路<br> 2.1 在.m文件类扩展增加一个label属性，（写在类扩展中是为了将子控件私有化，不暴漏在外部让被人随意修改属性值）</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  占位文字Label</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="built_in">UILabel</span> *phLabel;</span><br></pre></td></tr></table></figure>
<p> 2.2 重写getter方法，采用懒加载，不用关心控件的创建时间，用到时自动加载，同时初始化一些属性</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">UILabel</span> *)phLabel</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_phLabel) &#123;</span><br><span class="line">        <span class="built_in">UILabel</span> *phLabel = [[<span class="built_in">UILabel</span> alloc] init];</span><br><span class="line">         <span class="comment">// 文字自动换行</span></span><br><span class="line">        phLabel.numberOfLines = <span class="number">0</span>; </span><br><span class="line">        phLabel.x = <span class="number">4</span>;</span><br><span class="line">        phLabel.y = <span class="number">7</span>;</span><br><span class="line">        [<span class="keyword">self</span> addSubview:phLabel];</span><br><span class="line">        <span class="keyword">self</span>.phLabel = phLabel;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> _phLabel;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> 2.3 给控件添加监听器，代码同上1.3<br> 2.4 重写dealloc方法，移除监听器，同上1.4<br> 2.5 在- (void)textDidChange方法中控制label的显示或隐藏</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)textDidChange</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 有文字就隐藏</span></span><br><span class="line">    <span class="keyword">self</span>.phLabel.hidden = <span class="keyword">self</span>.hasText;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> 2.6 在<code>- (void)layoutSubviews</code>方法中动态计算占位文字的label大小</p>
</li>
</ol>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)layoutSubviews</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">super</span> layoutSubviews];</span><br><span class="line">    <span class="comment">// 确定label的宽度，高度由文字数量自动计算</span></span><br><span class="line">    <span class="built_in">CGSize</span> size = <span class="built_in">CGSizeMake</span>(<span class="keyword">self</span>.width - <span class="number">2</span> * <span class="keyword">self</span>.phLabel.x, MAXFLOAT);</span><br><span class="line">   <span class="comment">// 根据文字的字体属性、文字的数量动态计算label的尺寸</span></span><br><span class="line">    <span class="keyword">self</span>.phLabel.size = [<span class="keyword">self</span>.placeholder boundingRectWithSize:size options:<span class="built_in">NSStringDrawingUsesLineFragmentOrigin</span> attributes:@&#123;<span class="built_in">NSFontAttributeName</span> : <span class="keyword">self</span>.font&#125; context:<span class="literal">nil</span>].size;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注：label的font要在初始化时确定，不然程序会奔溃<br>    2.7 重写字体、占位文字的setter方法(满足控制器中可能随时修改占位文字的尺寸和大小)<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 占位文字</span></span><br><span class="line">- (<span class="keyword">void</span>)setPlaceholder:(<span class="built_in">NSString</span> *)placeholder</span><br><span class="line">&#123;</span><br><span class="line">    _placeholder = placeholder;</span><br><span class="line">    <span class="keyword">self</span>.phLabel.text = placeholder;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更新文字尺寸</span></span><br><span class="line">    [<span class="keyword">self</span> setNeedsLayout];</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 字体</span></span><br><span class="line">- (<span class="keyword">void</span>)setFont:(<span class="built_in">UIFont</span> *)font</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">super</span> setFont:font];</span><br><span class="line">    <span class="keyword">self</span>.phLabel.font = font;</span><br><span class="line">    [<span class="keyword">self</span> setNeedsLayout];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><code>setNeedsLayout</code>方法会在控件尺寸变化时调用<code>layoutSubviews</code>重新计算子控件的尺寸和大小</p>
<p>这种方式增加的占位文字有一个优势：</p>
<blockquote>
<p>占位文字可以跟随光标一起拖拽上下移动（弹簧效果），但利用<code>drawRect:</code>画上去的占位文字是固定的，没有拖拽效果</p>
</blockquote>
<p>控制器在拿到这个控件后，设置占位文字后就可以直接用了。</p>
</div></article></div></main><footer><div class="paginator"><a href="/2016/04/09/《百思不得姐》项目总结-63个知识点/" class="prev">PREV</a><a href="/2016/04/09/浅谈UITableView内Cell的选中细节过程/" class="next">NEXT</a></div><div class="copyright"><p>© 2016 - 2018 <a href="https://recherj.github.io">RecherJ</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>