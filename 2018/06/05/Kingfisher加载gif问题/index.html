<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> KingfisheråŠ è½½gifé—®é¢˜ Â· RecherJ's blog</title><meta name="description" content="KingfisheråŠ è½½gifé—®é¢˜ - RecherJ"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://recherj.github.io/atom.xml" title="RecherJ's blog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://weibo.com/u/2698628733" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/RecherJ" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">KingfisheråŠ è½½gifé—®é¢˜</h1><div class="post-info">Jun 5, 2018</div><div class="post-content"><p>ä¹‹å‰å°†æˆ‘ä»¬çš„ä¸€æ¬¾ Swift é¡¹ç›®ä¸­çš„å›¾ç‰‡åº“ï¼Œä»OCçš„ <a href="https://github.com/rs/SDWebImage" target="_blank" rel="noopener">SDWebImage</a> æ¢æˆäº†å–µç¥å†™çš„ <a href="https://github.com/onevcat/Kingfisher" target="_blank" rel="noopener">Kingfisher</a> , ä¸»è¦ä¸ºäº†å°½å¯èƒ½çº¯swiftå¼€å‘ï¼Œæ··ç¼–ç¼–è¯‘å®åœ¨æ˜¯å¤ªæ…¢äº†..</p>
<a id="more"></a>
<p>å› ä¸ºæ˜¯ä¸€æ¬¾ç”µå•†Appï¼Œè‡ªç„¶å°‘ä¸äº†å¤§é‡çš„å›¾ç‰‡ï¼Œé¦–é¡µæ˜¯ä»¿æ·˜å®æ¨¡å¼åˆ©ç”¨UICollectionViewå®ç°çš„å¤§é‡ç€‘å¸ƒæµçš„å•†å“ï¼Œäº§å“éœ€æ±‚è¦æ±‚å¢åŠ å¯¹gifåŠ¨å›¾çš„å®ç°ã€‚è¿™ä¸ªä¸éš¾å•Šï¼Œè¿…é€Ÿå°†UIImageViewçš„å›¾ç‰‡æ¢æˆäº†ä¸‹é¢çš„æ¨¡å¼</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">imageView.kf.setImage(with: <span class="type">URL</span>(string: imageURL))</span><br></pre></td></tr></table></figure>
<p>æ»šåŠ¨èµ·æ¥å‘ç°å¡çš„é£èµ·ï¼Œç›´æ¥è¢«äº§å“æ€¼å›æ¥äº†ã€‚ã€‚è¿™ä¸ªæ€ä¹ˆå¯ä»¥ï¼Ÿï¼Ÿsoï¼Œé—®é¢˜å‡ºåœ¨å“ªäº†å‘¢ï¼Œç®€å•æŸ¥çœ‹äº†ä¸‹æºç å‘ç°ï¼Œ<code>KingfisherManager</code> åœ¨ retrieveImage æ—¶å…ˆåˆ¤æ–­cacheä¸­æœ‰æ²¡æœ‰ï¼Œå†å»æ£€æŸ¥diskï¼Œå¦‚æœéƒ½æ²¡æœ‰å°±è°ƒç”¨ <code>ImageDownloader</code> å»å¼‚æ­¥ä¸‹è½½ï¼Œç„¶åå†ä¸»çº¿ç¨‹ä¸­å›è°ƒç»™è°ƒç”¨è€…ï¼Œå¹¶åœ¨å†…å­˜å’Œdiskä¸­æ­Œç¼“å­˜ä¸€ä»½ã€‚é—®é¢˜æ˜¯ï¼Œå›¾ç‰‡å›æ¥åçš„ decode é»˜è®¤æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­å®Œæˆçš„ï¼Œè¿™æ ·ä¸€æ¥å½“ scrolling æ—¶ï¼Œå°±ä¼šå‘ç”Ÿèµ„æºæŠ¢å¤ºï¼Œå ç”¨ä¸»çº¿ç¨‹å¯¼è‡´æ„ŸçŸ¥åˆ°æ˜æ˜¾çš„å¡é¡¿ï¼ˆç®€ç›´æ˜¯å°±æ˜¯æ‰å¸§ï¼Œæƒ¨ç›®å¿ç¹ğŸ˜­ï¼‰ï¼Œäºæ˜¯ä¹å»ç¿»äº†ä¸‹ <code>KingfisherOptionsInfo.swift</code> å‘ç°äº† <code>.backgroundDecode</code> å±æ€§</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// Decode the image in background thread before using.</span></span><br><span class="line"><span class="keyword">case</span> backgroundDecode</span><br></pre></td></tr></table></figure>
<p>å†å°†åŸæ¥è®¾ç½®å›¾ç‰‡çš„æ–¹æ³•æ”¹æˆäº†</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">imageView.kf.setImage(with: <span class="type">URL</span>(string: datas.squareImage), </span><br><span class="line">               placeholder: <span class="literal">nil</span>, </span><br><span class="line">                   options: [.backgroundDecode], </span><br><span class="line">             progressBlock: <span class="literal">nil</span>, </span><br><span class="line">         completionHandler: <span class="literal">nil</span>)</span><br></pre></td></tr></table></figure>
<p>æ¢æˆäº†å­çº¿ç¨‹ä¸­å» decode åæ»šåŠ¨æµ‹è¯•ï¼Œå‘ç° everything gonnaâ€™ smoothly!! hold on , æ€ä¹ˆ gif å›¾ä¸åŠ¨äº†ï¼Ÿï¼Ÿè¿™éƒ½è¦ä¸Šçº¿äº†ï¼Œå‡ºè¿™ç§å¹ºè›¾å­ï¼Ÿï¼Ÿäºæ˜¯ä¹èµ¶ç´§å» github ä¸Šçœ‹äº†çœ‹ issues ï¼Œ å‘ç°ä¸æ­¢æˆ‘ä¸€ä¸ªäººæœ‰é‡åˆ°è¿™ç§é—®é¢˜å•Šã€‚æ‰¾åˆ°äº† <a href="https://github.com/onevcat/Kingfisher/issues/880" target="_blank" rel="noopener">Canâ€™t play GIF with .backgroundDecode option</a> å’Œ ä½œè€…çš„ä¸€ä¸ªå›å¤ <a href="https://github.com/onevcat/Kingfisher/issues/625" target="_blank" rel="noopener">.backgroundDecode not working with GIF</a> ã€‚å–µç¥å¤§æ¦‚æ„æ€æ˜¯è¯´ backgroundDecode éœ€è¦å¹³è¡¡å†…å­˜å’ŒCPUçš„ä½¿ç”¨åœ¨ä¸¤ç§æ¨¡å¼ä¸‹ã€‚äºæ˜¯å°±æŠŠè‡ªå·±çš„æ‰€æœ‰é¦–é¡µæ¨¡æ¿ä¸­çš„ UIImageView å…¨éƒ¨æ”¹æˆç»§æ‰¿è‡ª <code>AnimatedUIImageView</code> ç±»ï¼Œä½¿ç”¨åå¡é¡¿çš„é—®é¢˜å¾—åˆ°äº†è§£å†³ï¼Œgif å›¾ä¹Ÿå¯ä»¥æ­£å¸¸åŠ¨ï¼Œä½†ä¼¼ä¹å¡é¡¿è¿˜æ˜¯å­˜åœ¨ï¼Œå¦å¤–åŠ¨å›¾å›¾ç‰‡é™¤äº†ç¬¬ä¸€å¸§å¤–å…¶ä»–å‹ç¼©éƒ½å¾ˆä¸¥é‡ã€‚</p>
<p>æœ€ç»ˆç»è¿‡åå¤æŸ¥é˜…å¤´æ–‡ä»¶ï¼Œæ‰¾åˆ°äº† <code>needsPrescaling</code> å’Œ  <code>runLoopMode</code> è¿™ä¸¤ä¸ªå±æ€§ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// Specifies whether the GIF frames should be pre-scaled to save memory. Default is true.</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> needsPrescaling = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/// The animation timer's run loop mode. Default is `NSRunLoopCommonModes`. Set this property to `NSDefaultRunLoopMode` will make the animation pause during UIScrollView scrolling.</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> runLoopMode = <span class="type">RunLoopMode</span>.commonModes &#123;</span><br><span class="line">  <span class="keyword">willSet</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> runLoopMode == newValue &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      stopAnimating()</span><br><span class="line">      displayLink.remove(from: .main, forMode: runLoopMode)</span><br><span class="line">      displayLink.add(to: .main, forMode: newValue)</span><br><span class="line">      startAnimating()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å°† <code>needsPrescaling</code> è®¾ç½®ä¸º falseï¼Œå¹¶å°† <code>runLoopMode</code> æ”¹åˆ° <code>.defaultRunLoopMode</code> é»˜è®¤æ¨¡å¼ä¸‹ï¼Œé—®é¢˜å¾—åˆ°äº†è§£å†³ã€‚ä½†å¡é¡¿æ‰å¸§è¿˜æ˜¯å­˜åœ¨ï¼Œåªæ˜¯ä¸é‚£ä¹ˆæ˜æ˜¾äº†ï¼ŒåæœŸå†ç€é‡å°†è¿™ä¸ªé—®é¢˜å†ä¼˜åŒ–ä¸‹ã€‚</p>
</div></article></div></main><footer><div class="paginator"><a href="/2018/06/13/fastlaneè‡ªåŠ¨åŒ–æ‰“åŒ…éƒ¨ç½²/" class="prev">PREV</a><a href="/2018/06/03/ä»¿æ·˜å®è´­ä¹°é¡µé¢/" class="next">NEXT</a></div><div class="copyright"><p>Â© 2016 - 2018 <a href="https://recherj.github.io">RecherJ</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>