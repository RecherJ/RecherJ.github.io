<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="map[]" />
    
    <link rel="shortcut icon" type="image/x-icon" href="https://recherj.github.io/img/favicon.ico">
    <title>KingfisheråŠ è½½gifé—®é¢˜</title>
    <meta name="generator" content="Hugo 0.41" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://recherj.github.io/css/main.css" />
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" />
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,400,200bold,400old" />
    
    <link rel="stylesheet" href="https://recherj.github.io/css/code.css">
    
    <!--[if lt IE 9]>
			<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
			<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
		<![endif]-->

    
  </head>

  <body>
    <div id="wrap">

      
      <nav class="navbar navbar-default">
  <div class="navbar-container">
    <div class="navbar-header">
      <a class="navbar-brand" href="https://recherj.github.io/">
        <img src="https://recherj.github.io//img/favicon.png" />
      </a>
      <span>åšå¾·è½½ç‰©ï¼Œä¸Šå–„è‹¥æ°´</span>
    </div>
    <ul class="nav navbar-nav navbar-right">
        
          
          <li><a href="/blog/">åšå®¢</a></li>
          
          <li><a href="/aboutme/">å…³äº</a></li>
          
        
        </ul>
  </div>
</nav>

      
      <div class="container article-content">
        <div class="article-top-block">
            <div class="blog-post">
              <h3>
                <strong><a href="https://recherj.github.io/blog/kingfisher%E5%8A%A0%E8%BD%BDgif%E9%97%AE%E9%A2%98/">KingfisheråŠ è½½gifé—®é¢˜</a></strong>
              </h3>
            </div>
            <div class="blog-title">
              <h4>
              June 5, 2018
                &nbsp;&nbsp;
                
              </h4>
            </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-body">
            <div class="blogpost">
              <p>ä¹‹å‰å°†æˆ‘ä»¬çš„ä¸€æ¬¾ Swift é¡¹ç›®ä¸­çš„å›¾ç‰‡åº“ï¼Œä»OCçš„ <a href="https://github.com/rs/SDWebImage">SDWebImage</a> æ¢æˆäº†å–µç¥å†™çš„ <a href="https://github.com/onevcat/Kingfisher">Kingfisher</a> , ä¸»è¦ä¸ºäº†å°½å¯èƒ½çº¯swiftå¼€å‘ï¼Œæ··ç¼–ç¼–è¯‘å®åœ¨æ˜¯å¤ªæ…¢äº†..</p>

<p></p>

<p>å› ä¸ºæ˜¯ä¸€æ¬¾ç”µå•†Appï¼Œè‡ªç„¶å°‘ä¸äº†å¤§é‡çš„å›¾ç‰‡ï¼Œé¦–é¡µæ˜¯ä»¿æ·˜å®æ¨¡å¼åˆ©ç”¨UICollectionViewå®ç°çš„å¤§é‡ç€‘å¸ƒæµçš„å•†å“ï¼Œäº§å“éœ€æ±‚è¦æ±‚å¢åŠ å¯¹gifåŠ¨å›¾çš„å®ç°ã€‚è¿™ä¸ªä¸éš¾å•Šï¼Œè¿…é€Ÿå°†UIImageViewçš„å›¾ç‰‡æ¢æˆäº†ä¸‹é¢çš„æ¨¡å¼</p>

<pre><code class="language-swift">imageView.kf.setImage(with: URL(string: imageURL))
</code></pre>

<p>æ»šåŠ¨èµ·æ¥å‘ç°å¡çš„é£èµ·ï¼Œç›´æ¥è¢«äº§å“æ€¼å›æ¥äº†ã€‚ã€‚è¿™ä¸ªæ€ä¹ˆå¯ä»¥ï¼Ÿï¼Ÿsoï¼Œé—®é¢˜å‡ºåœ¨å“ªäº†å‘¢ï¼Œç®€å•æŸ¥çœ‹äº†ä¸‹æºç å‘ç°ï¼Œ<code>KingfisherManager</code> åœ¨ retrieveImage æ—¶å…ˆåˆ¤æ–­cacheä¸­æœ‰æ²¡æœ‰ï¼Œå†å»æ£€æŸ¥diskï¼Œå¦‚æœéƒ½æ²¡æœ‰å°±è°ƒç”¨ <code>ImageDownloader</code> å»å¼‚æ­¥ä¸‹è½½ï¼Œç„¶åå†ä¸»çº¿ç¨‹ä¸­å›è°ƒç»™è°ƒç”¨è€…ï¼Œå¹¶åœ¨å†…å­˜å’Œdiskä¸­æ­Œç¼“å­˜ä¸€ä»½ã€‚é—®é¢˜æ˜¯ï¼Œå›¾ç‰‡å›æ¥åçš„ decode é»˜è®¤æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­å®Œæˆçš„ï¼Œè¿™æ ·ä¸€æ¥å½“ scrolling æ—¶ï¼Œå°±ä¼šå‘ç”Ÿèµ„æºæŠ¢å¤ºï¼Œå ç”¨ä¸»çº¿ç¨‹å¯¼è‡´æ„ŸçŸ¥åˆ°æ˜æ˜¾çš„å¡é¡¿ï¼ˆç®€ç›´æ˜¯å°±æ˜¯æ‰å¸§ï¼Œæƒ¨ç›®å¿ç¹ğŸ˜­ï¼‰ï¼Œäºæ˜¯ä¹å»ç¿»äº†ä¸‹ <code>KingfisherOptionsInfo.swift</code> å‘ç°äº† <code>.backgroundDecode</code> å±æ€§</p>

<pre><code class="language-swift">/// Decode the image in background thread before using.
case backgroundDecode
</code></pre>

<p>å†å°†åŸæ¥è®¾ç½®å›¾ç‰‡çš„æ–¹æ³•æ”¹æˆäº†</p>

<pre><code class="language-swift">imageView.kf.setImage(with: URL(string: datas.squareImage), 
               placeholder: nil, 
                   options: [.backgroundDecode], 
             progressBlock: nil, 
         completionHandler: nil)
</code></pre>

<p>æ¢æˆäº†å­çº¿ç¨‹ä¸­å» decode åæ»šåŠ¨æµ‹è¯•ï¼Œå‘ç° everything gonna&rsquo; smoothly!! hold on , æ€ä¹ˆ gif å›¾ä¸åŠ¨äº†ï¼Ÿï¼Ÿè¿™éƒ½è¦ä¸Šçº¿äº†ï¼Œå‡ºè¿™ç§å¹ºè›¾å­ï¼Ÿï¼Ÿäºæ˜¯ä¹èµ¶ç´§å» github ä¸Šçœ‹äº†çœ‹ issues ï¼Œ å‘ç°ä¸æ­¢æˆ‘ä¸€ä¸ªäººæœ‰é‡åˆ°è¿™ç§é—®é¢˜å•Šã€‚æ‰¾åˆ°äº† <a href="https://github.com/onevcat/Kingfisher/issues/880">Can&rsquo;t play GIF with .backgroundDecode option</a> å’Œ ä½œè€…çš„ä¸€ä¸ªå›å¤ <a href="https://github.com/onevcat/Kingfisher/issues/625">.backgroundDecode not working with GIF</a> ã€‚å–µç¥å¤§æ¦‚æ„æ€æ˜¯è¯´ backgroundDecode éœ€è¦å¹³è¡¡å†…å­˜å’ŒCPUçš„ä½¿ç”¨åœ¨ä¸¤ç§æ¨¡å¼ä¸‹ã€‚äºæ˜¯å°±æŠŠè‡ªå·±çš„æ‰€æœ‰é¦–é¡µæ¨¡æ¿ä¸­çš„ UIImageView å…¨éƒ¨æ”¹æˆç»§æ‰¿è‡ª <code>AnimatedUIImageView</code> ç±»ï¼Œä½¿ç”¨åå¡é¡¿çš„é—®é¢˜å¾—åˆ°äº†è§£å†³ï¼Œgif å›¾ä¹Ÿå¯ä»¥æ­£å¸¸åŠ¨ï¼Œä½†ä¼¼ä¹å¡é¡¿è¿˜æ˜¯å­˜åœ¨ï¼Œå¦å¤–åŠ¨å›¾å›¾ç‰‡é™¤äº†ç¬¬ä¸€å¸§å¤–å…¶ä»–å‹ç¼©éƒ½å¾ˆä¸¥é‡ã€‚</p>

<p>æœ€ç»ˆç»è¿‡åå¤æŸ¥é˜…å¤´æ–‡ä»¶ï¼Œæ‰¾åˆ°äº† <code>needsPrescaling</code> å’Œ  <code>runLoopMode</code> è¿™ä¸¤ä¸ªå±æ€§ã€‚</p>

<pre><code class="language-swift">/// Specifies whether the GIF frames should be pre-scaled to save memory. Default is true.
public var needsPrescaling = true

/// The animation timer's run loop mode. Default is `NSRunLoopCommonModes`. Set this property to `NSDefaultRunLoopMode` will make the animation pause during UIScrollView scrolling.
public var runLoopMode = RunLoopMode.commonModes {
  willSet {
    if runLoopMode == newValue {
      return
    } else {
      stopAnimating()
      displayLink.remove(from: .main, forMode: runLoopMode)
      displayLink.add(to: .main, forMode: newValue)
      startAnimating()
    }
  }
}
</code></pre>

<p>å°† <code>needsPrescaling</code> è®¾ç½®ä¸º falseï¼Œå¹¶å°† <code>runLoopMode</code> æ”¹åˆ° <code>.defaultRunLoopMode</code> é»˜è®¤æ¨¡å¼ä¸‹ï¼Œé—®é¢˜å¾—åˆ°äº†è§£å†³ã€‚ä½†å¡é¡¿æ‰å¸§è¿˜æ˜¯å­˜åœ¨ï¼Œåªæ˜¯ä¸é‚£ä¹ˆæ˜æ˜¾äº†ï¼ŒåæœŸå†ç€é‡å°†è¿™ä¸ªé—®é¢˜å†ä¼˜åŒ–ä¸‹ã€‚</p>
              <hr>
              <div class="related-posts">
                <h5>Related Posts</h5>
                
              </div>
            </div>
          </div>
          <hr>
        <div class="disqus">
  <div id="disqus_thread"></div>
  <script type="text/javascript">

    (function() {
      
      
      if (window.location.hostname == "localhost")
        return;

      var disqus_shortname = '';
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
        </div>
      </div>
      
    </div>

    
    <footer>
  <div id="footer">
    <div class="footer-container">
      <p class="text-muted">&copy; All rights reserved. Powered by <a href="https://gohugo.io/">Hugo</a> and
      <a href="http://github.com/RecherJ/canary/">canary</a> with â™¥</p>
    </div>
  </div>
</footer>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="https://recherj.github.io/js/docs.min.js"></script>
<script src="https://recherj.github.io/js/main.js"></script>

<script src="https://recherj.github.io/js/ie10-viewport-bug-workaround.js"></script>


    
  </body>
</html>
